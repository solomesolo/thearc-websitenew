<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Your Personalized Screening Plan - Right Screening Finder</title>
    <!-- Cache bust: v3 - Force invalidation -->
    <meta name="cache-bust" content="v3-1760462000">
    
    <!-- Fixed Mixpanel Script -->
    <script src="/mixpanel-fixed.js"></script>
    
    <!-- Simple PDF Generation without external libraries -->
    <script>
        // Simple PDF generation using browser's print functionality
        function generateSimplePDF() {
            console.log('üîÑ Generating PDF using browser print...');
            
            // Create a new window with the content
            const printWindow = window.open('', '_blank');
            const container = document.querySelector('.container');
            
            if (!container) {
                alert('Error: Content not found');
                return;
            }
            
            // Get the content HTML
            const content = container.innerHTML;
            
            // Create the print document
            printWindow.document.write(`
                <!DOCTYPE html>
                <html>
                <head>
                    <title>My Screening Plan - Right Screening Finder</title>
                    <style>
                        body {
                            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
                            line-height: 1.6;
                            background: linear-gradient(135deg, #0a0a0a 0%, #1a1a1a 50%, #0f0f0f 100%);
                            color: #ffffff;
                            max-width: 1200px;
                            margin: 0 auto;
                            padding: 2rem;
                            min-height: 100vh;
                        }
                        .header-card {
                            background: rgba(26, 26, 26, 0.95);
                            border: 1px solid rgba(255, 255, 255, 0.1);
                            border-radius: 16px;
                            padding: 2rem;
                            margin-bottom: 2rem;
                            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
                        }
                        .header-title {
                            font-size: 2.5rem;
                            font-weight: 700;
                            background: linear-gradient(135deg, #3b82f6, #8b5cf6);
                            -webkit-background-clip: text;
                            -webkit-text-fill-color: transparent;
                            background-clip: text;
                            margin-bottom: 1rem;
                        }
                        .header-subtitle {
                            color: #cbd5e1;
                            font-size: 1.1rem;
                        }
                        .summary-card {
                            background: rgba(26, 26, 26, 0.95);
                            border: 1px solid rgba(255, 255, 255, 0.1);
                            border-radius: 16px;
                            padding: 2rem;
                            margin-bottom: 2rem;
                            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
                        }
                        .summary-title {
                            font-size: 1.8rem;
                            font-weight: 600;
                            color: #ffffff;
                            margin-bottom: 1rem;
                        }
                        .summary-text {
                            font-size: 1rem;
                            color: #cbd5e1;
                            line-height: 1.6;
                        }
                        .urgent-section {
                            background: rgba(26, 26, 26, 0.95);
                            border: 1px solid rgba(239, 68, 68, 0.3);
                            border-radius: 16px;
                            padding: 2rem;
                            margin-bottom: 2rem;
                            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
                            position: relative;
                        }
                        .urgent-section::before {
                            content: '';
                            position: absolute;
                            top: 0;
                            left: 0;
                            right: 0;
                            bottom: 0;
                            background: linear-gradient(135deg, rgba(239, 68, 68, 0.05) 0%, rgba(220, 38, 38, 0.05) 100%);
                            border-radius: 16px;
                            z-index: -1;
                        }
                        .urgent-title {
                            font-size: 1.8rem;
                            font-weight: 600;
                            color: #ef4444;
                            margin-bottom: 1rem;
                        }
                        .urgent-test {
                            background: rgba(239, 68, 68, 0.1);
                            border: 1px solid rgba(239, 68, 68, 0.3);
                            border-radius: 12px;
                            padding: 1.5rem;
                            margin-bottom: 1rem;
                            display: flex;
                            justify-content: space-between;
                            align-items: center;
                        }
                        .test-name {
                            font-weight: 600;
                            color: #ef4444;
                            font-size: 1.1rem;
                        }
                        .test-status {
                            color: #cbd5e1;
                            font-size: 0.9rem;
                            background: rgba(239, 68, 68, 0.2);
                            padding: 0.5rem 1rem;
                            border-radius: 8px;
                        }
                        .categories-grid {
            display: flex;
            flex-direction: column;
            gap: 2rem;
            margin-top: 3rem;
        }
        
        /* Elegant Urgent Tests Section */
        .urgent-tests-section {
            background: linear-gradient(135deg, rgba(26, 26, 26, 0.98) 0%, rgba(20, 20, 20, 0.98) 100%);
            border: 1px solid rgba(139, 92, 246, 0.2);
            border-radius: 20px;
            padding: 3rem;
            margin-bottom: 3rem;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
        }
        
        .urgent-tests-header {
            display: flex;
            align-items: center;
            margin-bottom: 3rem;
            padding-bottom: 2rem;
            border-bottom: 1px solid rgba(139, 92, 246, 0.2);
        }
        
        .urgent-tests-icon {
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, #ef4444, #dc2626);
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 1.5rem;
            font-size: 2rem;
            box-shadow: 0 8px 20px rgba(239, 68, 68, 0.3);
        }
        
        .urgent-tests-title {
            font-size: 2.5rem;
            font-weight: 800;
            color: #ffffff;
            margin: 0;
            background: linear-gradient(135deg, #ffffff, #e2e8f0);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .urgent-tests-subtitle {
            font-size: 1.1rem;
            color: #94a3b8;
            margin: 0.5rem 0 0 0;
            font-weight: 500;
        }
        
        .urgent-tests-grid {
            display: flex;
            flex-direction: column;
            gap: 2rem;
        }
        
        .urgent-test-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 2rem;
            border-left: 4px solid #8b5cf6;
            transition: all 0.3s ease;
        }
        
        .urgent-test-card:hover {
            background: rgba(255, 255, 255, 0.08);
            border-left-color: #a855f7;
            transform: translateY(-2px);
        }
        
        .urgent-test-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }
        
        .urgent-test-title {
            font-size: 1.3rem;
            font-weight: 700;
            color: #ffffff;
            flex: 1;
            margin-right: 2rem;
        }
        
        .urgent-test-status {
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 700;
            text-transform: uppercase;
            white-space: nowrap;
            background: linear-gradient(135deg, #f59e0b, #d97706);
            color: #ffffff;
            box-shadow: 0 4px 12px rgba(245, 158, 11, 0.3);
        }
        
        .urgent-test-content {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 2rem;
            align-items: start;
        }
        
        .urgent-test-explanation {
            color: #e2e8f0;
            line-height: 1.6;
        }
        
        .urgent-test-explanation h4 {
            color: #8b5cf6;
            font-size: 0.9rem;
            font-weight: 700;
            margin: 0 0 0.75rem 0;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .urgent-test-explanation p {
            margin: 0;
            font-size: 1rem;
            line-height: 1.6;
        }
        
        .urgent-test-actions {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            align-items: flex-end;
        }
        
        .urgent-catalog-btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #8b5cf6, #a855f7);
            color: white;
            text-decoration: none;
            padding: 1rem 2rem;
            border-radius: 12px;
            font-weight: 700;
            font-size: 1rem;
            transition: all 0.3s ease;
            box-shadow: 0 6px 20px rgba(139, 92, 246, 0.3);
            border: none;
            cursor: pointer;
            min-width: 180px;
            letter-spacing: 0.5px;
        }
        
        .urgent-catalog-btn:hover {
            background: linear-gradient(135deg, #a855f7, #c084fc);
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(139, 92, 246, 0.4);
        }
        
        .urgent-match-info {
            font-size: 0.85rem;
            color: #94a3b8;
            font-style: italic;
            text-align: right;
            margin: 0;
        }
        
        /* Mobile Responsive */
        @media (max-width: 768px) {
            .urgent-tests-section {
                padding: 2rem;
                margin-bottom: 2rem;
            }
            
            .urgent-tests-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 1rem;
                margin-bottom: 2rem;
                padding-bottom: 1.5rem;
            }
            
            .urgent-tests-icon {
                margin-right: 0;
                margin-bottom: 0.5rem;
                width: 50px;
                height: 50px;
                font-size: 1.5rem;
            }
            
            .urgent-tests-title {
                font-size: 2rem;
            }
            
            .urgent-tests-subtitle {
                font-size: 1rem;
            }
            
            .urgent-tests-grid {
                gap: 1.5rem;
            }
            
            .urgent-test-card {
                padding: 1.5rem;
            }
            
            .urgent-test-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 1rem;
                margin-bottom: 1rem;
            }
            
            .urgent-test-title {
                font-size: 1.1rem;
                margin-right: 0;
            }
            
            .urgent-test-content {
                grid-template-columns: 1fr;
                gap: 1.5rem;
            }
            
            .urgent-test-actions {
                align-items: flex-start;
                gap: 0.75rem;
            }
            
            .urgent-catalog-btn {
                min-width: 180px;
                padding: 0.875rem 1.5rem;
                font-size: 0.9rem;
                width: 100%;
            }
            
            .urgent-match-info {
                text-align: left;
                width: 100%;
            }
        }
                        .category-card {
                            background: rgba(26, 26, 26, 0.95);
                            border: 1px solid rgba(255, 255, 255, 0.1);
                            border-radius: 16px;
                            padding: 2rem;
                            margin-bottom: 2rem;
                            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
                        }
                        .category-title {
                            font-size: 1.5rem;
                            font-weight: 600;
                            color: #3b82f6;
                            margin-bottom: 1rem;
                        }
                        .category-item {
                            background: rgba(255, 255, 255, 0.05);
                            border: 1px solid rgba(255, 255, 255, 0.1);
                            border-radius: 12px;
                            padding: 1.5rem;
                            margin-bottom: 1rem;
                            text-align: center;
                        }
                        .category-icon {
                            font-size: 3rem;
                            margin-bottom: 1rem;
                            display: block;
                        }
                        .category-title {
                            font-size: 1.5rem;
                            font-weight: 700;
                            color: #ffffff;
                            margin-bottom: 1rem;
                        }
                        .category-description {
                            color: #cbd5e1;
                            margin-bottom: 1.5rem;
                            line-height: 1.6;
                        }
                        .category-features {
                            display: flex;
                            flex-wrap: wrap;
                            gap: 0.5rem;
                            justify-content: center;
                            margin-bottom: 1rem;
                        }
                        .feature-tag {
                            background: rgba(99, 102, 241, 0.1);
                            color: #a78bfa;
                            padding: 0.25rem 0.75rem;
                            border-radius: 12px;
                            font-size: 0.875rem;
                            font-weight: 500;
                        }
                        .category-count {
                            color: #94a3b8;
                            font-size: 0.875rem;
                            font-weight: 500;
                        }
                        .next-steps {
                            background: rgba(26, 26, 26, 0.95);
                            border: 1px solid rgba(59, 130, 246, 0.3);
                            border-radius: 16px;
                            padding: 2rem;
                            margin-top: 2rem;
                            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
                        }
                        .next-steps-title {
                            font-size: 1.8rem;
                            font-weight: 600;
                            color: #3b82f6;
                            margin-bottom: 1.5rem;
                        }
                        .step-item {
                            background: rgba(255, 255, 255, 0.05);
                            border: 1px solid rgba(255, 255, 255, 0.1);
                            border-radius: 12px;
                            padding: 1.5rem;
                            margin-bottom: 1rem;
                        }
                        .step-title {
                            font-weight: 600;
                            color: #ffffff;
                            margin-bottom: 0.5rem;
                            font-size: 1.1rem;
                        }
                        .step-description {
                            color: #cbd5e1;
                            font-size: 0.95rem;
                            line-height: 1.6;
                        }
                        .timeframe-header {
                            display: flex;
                            align-items: center;
                            margin-bottom: 1rem;
                        }
                        .timeframe-label {
                            background: linear-gradient(135deg, #3b82f6, #8b5cf6);
                            color: white;
                            padding: 0.5rem 1rem;
                            border-radius: 8px;
                            font-size: 0.875rem;
                            font-weight: 600;
                        }
                        .timeframe-line {
                            height: 2px;
                            background: linear-gradient(90deg, #3b82f6, #8b5cf6);
                            flex: 1;
                            margin-right: 1rem;
                        }
                        .timeframe-line.urgent {
                            background: linear-gradient(90deg, #ef4444, #dc2626);
                        }
                        .timeframe-line.soon {
                            background: linear-gradient(90deg, #f59e0b, #d97706);
                        }
                        .timeframe-line.later {
                            background: linear-gradient(90deg, #10b981, #059669);
                        }
                        @media print {
                            body { 
                                margin: 0; 
                                padding: 15px; 
                                background: linear-gradient(135deg, #0a0a0a 0%, #1a1a1a 50%, #0f0f0f 100%) !important;
                                color: #ffffff !important;
                            }
                            .header-card, .summary-card, .urgent-section, .category-card, .next-steps {
                                break-inside: avoid;
                                background: rgba(26, 26, 26, 0.95) !important;
                                border: 1px solid rgba(255, 255, 255, 0.1) !important;
                            }
                        }
                    </style>
                </head>
                <body>
                    <div style="text-align: center; margin-bottom: 40px; padding: 30px; background: rgba(26, 26, 26, 0.95); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 16px; box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);">
                        <h1 style="background: linear-gradient(135deg, #3b82f6, #8b5cf6); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; margin: 0; font-size: 32px; font-weight: 700;">Right Screening Finder</h1>
                        <p style="color: #cbd5e1; margin: 10px 0 0 0; font-size: 18px; font-weight: 500;">Personalized Health Screening Plan</p>
                        <p style="color: #94a3b8; margin: 15px 0 0 0; font-size: 14px;">Generated on ${new Date().toLocaleDateString()}</p>
                    </div>
                    ${content}
                    <div style="margin-top: 40px; padding: 30px; background: rgba(26, 26, 26, 0.95); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 16px; text-align: center; color: #94a3b8; font-size: 12px;">
                        <p style="margin: 0 0 10px 0; color: #cbd5e1; font-weight: 500;">Generated by Right Screening Finder ‚Ä¢ ${new Date().toLocaleDateString()}</p>
                        <p style="margin: 0; color: #94a3b8;">This report is for informational purposes only and should not replace professional medical advice.</p>
                    </div>
                </body>
                </html>
            `);
            
            printWindow.document.close();
            
            // Wait for content to load, then trigger print
            setTimeout(() => {
                printWindow.print();
                printWindow.close();
            }, 500);
            
            console.log('‚úÖ PDF generation initiated');
        }
    </script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        html, body {
            background-color: #0a0a0a !important;
            background-image: linear-gradient(135deg, #0a0a0a 0%, #1a1a1a 50%, #0f0f0f 100%) !important;
            color: #ffffff !important;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            line-height: 1.6;
            min-height: 100vh;
            color-scheme: dark !important;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }
        
        /* Header Section */
        .header-card {
            background-color: rgba(26, 26, 26, 0.95);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
        }
        
        .header-title {
            font-size: 2.5rem;
            font-weight: 700;
            background: linear-gradient(135deg, #3b82f6, #8b5cf6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 1rem;
        }
        
        .header-subtitle {
            font-size: 1.1rem;
            color: #cbd5e1;
        }
        
        /* Assessment Summary */
        .summary-card {
            background-color: rgba(26, 26, 26, 0.95);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
        }
        
        .summary-title {
            font-size: 1.8rem;
            font-weight: 600;
            color: #ffffff;
            margin-bottom: 1rem;
        }
        
        .summary-text {
            font-size: 1rem;
            color: #cbd5e1;
            line-height: 1.6;
        }
        
        /* Urgent Tests Section */
        .urgent-section {
            background-color: rgba(26, 26, 26, 0.95);
            border: 1px solid rgba(239, 68, 68, 0.3);
            border-radius: 16px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            position: relative;
        }
        
        .urgent-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.05) 0%, rgba(220, 38, 38, 0.05) 100%);
            border-radius: 16px;
            z-index: -1;
        }
        
        .urgent-title {
            font-size: 1.8rem;
            font-weight: 700;
            color: #ef4444;
            margin-bottom: 1.5rem;
            text-transform: uppercase;
        }
        
        /* Catalog Link Styles */
        .catalog-link {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
            align-items: flex-end;
        }
        
        .catalog-btn {
            display: inline-flex;
            align-items: center;
            background: linear-gradient(135deg, #8b5cf6, #a855f7);
            color: white;
            text-decoration: none;
            padding: 1rem 2rem;
            border-radius: 12px;
            font-weight: 700;
            font-size: 1rem;
            transition: all 0.3s ease;
            box-shadow: 0 6px 20px rgba(139, 92, 246, 0.3);
            border: none;
            cursor: pointer;
            min-width: 180px;
            justify-content: center;
            letter-spacing: 0.5px;
        }
        
        .catalog-btn:hover {
            background: linear-gradient(135deg, #a855f7, #c084fc);
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(139, 92, 246, 0.4);
        }
        
        .match-info {
            font-size: 0.85rem;
            color: #94a3b8;
            font-style: italic;
            text-align: right;
            margin: 0;
        }
        
        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(4px);
        }
        
        .modal-content {
            background: linear-gradient(135deg, #1a1a1a 0%, #2a2a2a 100%);
            margin: 5% auto;
            padding: 0;
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            width: 90%;
            max-width: 800px;
            max-height: 80vh;
            overflow: hidden;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.5);
        }
        
        .modal-header {
            background: linear-gradient(135deg, #8b5cf6, #a855f7);
            padding: 1.5rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-header h2 {
            color: white;
            margin: 0;
            font-size: 1.5rem;
            font-weight: 600;
        }
        
        .close {
            color: white;
            font-size: 2rem;
            font-weight: bold;
            cursor: pointer;
            transition: opacity 0.3s ease;
        }
        
        .close:hover {
            opacity: 0.7;
        }
        
        .modal-body {
            padding: 2rem;
            max-height: 60vh;
            overflow-y: auto;
        }
        
        .loading-state {
            text-align: center;
            padding: 2rem;
        }
        
        .spinner {
            border: 3px solid rgba(139, 92, 246, 0.3);
            border-top: 3px solid #8b5cf6;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .provider-list {
            display: grid;
            gap: 1rem;
        }
        
        .provider-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 1.5rem;
            transition: all 0.3s ease;
        }
        
        .provider-card:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: rgba(139, 92, 246, 0.5);
            transform: translateY(-2px);
        }
        
        .provider-header {
            display: flex;
            align-items: center;
            margin-bottom: 1rem;
        }
        
        .provider-logo {
            width: 48px;
            height: 48px;
            border-radius: 8px;
            margin-right: 1rem;
            object-fit: cover;
        }
        
        .provider-info h3 {
            color: white;
            margin: 0 0 0.25rem 0;
            font-size: 1.1rem;
        }
        
        .provider-location {
            color: #94a3b8;
            font-size: 0.9rem;
        }
        
        .provider-description {
            color: #cbd5e1;
            font-size: 0.9rem;
            line-height: 1.5;
            margin-bottom: 1rem;
        }
        
        .provider-price {
            color: #8b5cf6;
            font-weight: 600;
            font-size: 1.1rem;
            margin-bottom: 1rem;
        }
        
        .provider-actions {
            display: flex;
            gap: 0.75rem;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #8b5cf6, #a855f7);
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
        }
        
        .btn-primary:hover {
            background: linear-gradient(135deg, #a855f7, #c084fc);
            transform: translateY(-1px);
        }
        
        .btn-secondary {
            background: transparent;
            color: #8b5cf6;
            border: 1px solid #8b5cf6;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
        }
        
        .btn-secondary:hover {
            background: rgba(139, 92, 246, 0.1);
        }
        
        /* Responsive Design */
        @media (max-width: 768px) {
            .urgent-test-content {
                grid-template-columns: 1fr;
                gap: 1rem;
            }
            
            .urgent-test-actions {
                align-items: flex-start;
            }
            
            .catalog-btn {
                min-width: 160px;
                padding: 0.875rem 1.5rem;
            font-size: 0.9rem;
            }
            
            .test-content {
                grid-template-columns: 1fr;
                gap: 1rem;
            }
            
            .test-actions {
                align-items: flex-start;
            }
            
            .urgent-test-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 0.75rem;
            }
            
            .urgent-test-status {
                align-self: flex-start;
            }
            
            .test-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 0.75rem;
        }
        
        .test-status {
                align-self: flex-start;
            }
            
            .category-tests {
                flex-direction: column;
                gap: 1rem;
            }
            
            .category-test {
                min-width: auto;
                max-width: none;
            }
        }
        
        .urgent-test {
            background-color: rgba(255, 255, 255, 0.05);
            border-radius: 16px;
            padding: 2rem;
            margin-bottom: 2rem;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }
        
        .urgent-test:hover {
            background-color: rgba(255, 255, 255, 0.08);
            border-color: rgba(139, 92, 246, 0.3);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
        }
        
        .urgent-test-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            gap: 1rem;
        }
        
        .urgent-test-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: white;
            margin: 0;
            flex: 1;
        }
        
        .urgent-test-status {
            padding: 0.75rem 1.5rem;
            border-radius: 25px;
            font-size: 0.875rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            white-space: nowrap;
            flex-shrink: 0;
        }
        
        .status-recommended {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
        }
        
        .status-never-done {
            background: linear-gradient(135deg, #f59e0b, #d97706);
            color: white;
            box-shadow: 0 4px 12px rgba(245, 158, 11, 0.3);
        }
        
        .urgent-test-content {
            display: grid !important;
            grid-template-columns: 3fr 1fr !important;
            gap: 2rem !important;
            align-items: start !important;
            width: 100% !important;
        }
        
        .urgent-test-explanation {
            color: #e2e8f0;
            line-height: 1.7;
            font-size: 1rem;
            margin: 0;
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }
        
        .urgent-test-actions {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            align-items: flex-end;
        }
        
        .urgent-test-timeframe {
            color: #8b5cf6;
            font-weight: 600;
            font-size: 0.95rem;
            text-align: right;
            margin: 0;
        }
        
        /* Categories Grid */
        .categories-grid {
            display: flex;
            flex-direction: column;
            gap: 2rem;
            margin-bottom: 2rem;
        }
        
        .category-card {
            background-color: rgba(26, 26, 26, 0.95);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 2rem;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            transition: all 0.3s ease;
        }
        
        .category-card:hover {
            background-color: rgba(26, 26, 26, 1);
            border-color: rgba(139, 92, 246, 0.3);
            transform: translateY(-2px);
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.4);
        }
        
        .category-header {
            display: flex;
            align-items: center;
            margin-bottom: 1.5rem;
        }
        
        .category-icon {
            width: 56px;
            height: 56px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 1.5rem;
            font-size: 2rem;
            transition: all 0.3s ease;
            background: rgba(139, 92, 246, 0.1);
            border-radius: 12px;
        }
        
        .category-icon:hover {
            transform: scale(1.1);
            background: rgba(139, 92, 246, 0.2);
        }
        
        .icon-cardiovascular { }
        .icon-metabolic { }
        .icon-hormonal { }
        .icon-nutritional { }
        .icon-longevity { }
        .icon-gut { }
        
        .category-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: #ffffff;
        }
        
        .category-description {
            font-size: 1rem;
            color: #cbd5e1;
            margin-bottom: 0;
            line-height: 1.6;
        }
        
        .category-tests {
            display: flex;
            flex-direction: row;
            gap: 1.5rem;
            flex-wrap: wrap;
        }
        
        .category-test {
            background-color: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 1.5rem;
            border-left: 4px solid #8b5cf6;
            transition: all 0.3s ease;
            flex: 1;
            min-width: 300px;
            width: 100%;
        }
        
        .category-test:hover {
            background-color: rgba(255, 255, 255, 0.08);
            border-left-color: #a855f7;
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
        }
        
        .test-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            gap: 1rem;
        }
        
        .test-title {
            font-size: 1.1rem;
            font-weight: 700;
            color: #ffffff;
            flex: 1;
        }
        
        .test-status {
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 700;
            text-transform: uppercase;
            white-space: nowrap;
            flex-shrink: 0;
        }
        
        .status-due-soon {
            background: linear-gradient(135deg, #f59e0b, #d97706);
            color: #ffffff;
            box-shadow: 0 4px 12px rgba(245, 158, 11, 0.3);
        }
        
        .test-content {
            display: grid !important;
            grid-template-columns: 3fr 1fr !important;
            gap: 2rem !important;
            align-items: start !important;
            width: 100% !important;
        }
        
        .test-explanation {
            color: #e2e8f0;
            line-height: 1.6;
            margin: 0;
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }
        
        .explanation-section {
            background: rgba(255, 255, 255, 0.03) !important;
            padding: 1.5rem !important;
            border-radius: 12px !important;
            border-left: 4px solid #8b5cf6 !important;
            margin-bottom: 1rem !important;
            width: 100% !important;
            max-width: none !important;
        }
        
        .explanation-section h4 {
            color: #8b5cf6 !important;
            font-size: 1rem !important;
            font-weight: 700 !important;
            margin: 0 0 0.75rem 0 !important;
            text-transform: uppercase !important;
            letter-spacing: 0.5px !important;
        }
        
        .explanation-section p {
            color: #e2e8f0 !important;
            margin: 0 !important;
            font-size: 1rem !important;
            line-height: 1.6 !important;
            max-width: none !important;
            width: 100% !important;
        }
        
        .test-actions {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
            align-items: flex-end;
        }
        
        /* Next Steps Section */
        .next-steps {
            background-color: rgba(26, 26, 26, 0.95);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
        }
        
        .next-steps-title {
            font-size: 1.8rem;
            font-weight: 600;
            color: #ffffff;
            margin-bottom: 1.5rem;
        }
        
        .timeframe-section {
            margin-bottom: 1.5rem;
        }
        
        .timeframe-header {
            display: flex;
            align-items: center;
            margin-bottom: 1rem;
        }
        
        .timeframe-line {
            width: 4px;
            height: 40px;
            border-radius: 2px;
            margin-right: 1rem;
        }
        
        .line-urgent { background-color: #ef4444; }
        .line-medium { background-color: #10b981; }
        
        .timeframe-label {
            font-size: 1.1rem;
            font-weight: 600;
            color: #ffffff;
        }
        
        .timeframe-actions {
            margin-left: 2rem;
        }
        
        .action-item {
            font-size: 0.95rem;
            color: #cbd5e1;
            margin-bottom: 0.5rem;
            padding-left: 1.5rem;
            position: relative;
            display: flex;
            align-items: center;
        }
        
        .action-item::before {
            content: '‚úì';
            position: absolute;
            left: 0;
            color: #3b82f6;
            font-size: 1.2rem;
            font-weight: bold;
        }
        
        /* Download Button */
        .download-section {
            text-align: center;
            margin-bottom: 2rem;
        }
        
        .download-btn {
            background: linear-gradient(135deg, #3b82f6 0%, #8b5cf6 100%);
            color: #ffffff;
            border: none;
            padding: 1rem 2rem;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 600;
            text-transform: uppercase;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 10px 20px rgba(59, 130, 246, 0.3);
        }
        
        .download-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 15px 30px rgba(59, 130, 246, 0.4);
        }
        
        .download-btn:disabled {
            opacity: 0.7;
            cursor: not-allowed;
            transform: none;
        }
        
        .share-btn {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            color: #ffffff;
            border: none;
            padding: 1rem 2rem;
            border-radius: 12px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 0.5rem;
            box-shadow: 0 10px 20px rgba(245, 158, 11, 0.3);
        }
        
        .share-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 15px 30px rgba(245, 158, 11, 0.4);
        }
        
        .new-assessment-btn {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: #ffffff;
            border: none;
            padding: 1rem 2rem;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 600;
            text-transform: uppercase;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 10px 20px rgba(16, 185, 129, 0.3);
            margin-left: 1rem;
        }
        
        .new-assessment-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 15px 30px rgba(16, 185, 129, 0.4);
        }
        
        /* Motivational Quote */
        .quote-section {
            background-color: rgba(26, 26, 26, 0.95);
            border: 1px solid rgba(16, 185, 129, 0.3);
            border-radius: 16px;
            padding: 2rem;
            text-align: center;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
        }
        
        .quote-text {
            font-size: 1.1rem;
            font-style: italic;
            color: #ffffff;
            line-height: 1.6;
        }
        
        /* Responsive Design */
        @media (max-width: 768px) {
            .container {
                padding: 0.75rem;
            }
            
            .header-title {
                font-size: 1.75rem;
            }
            
            .categories-grid {
                flex-direction: column;
            }
            
            .urgent-test {
                flex-direction: column;
            }
            
            .test-status {
                margin-left: 0;
                margin-top: 1rem;
                align-self: flex-start;
            }
            
            .download-btn, .share-btn, .new-assessment-btn {
                width: 100%;
                font-size: 0.875rem;
                padding: 0.75rem 1rem;
                min-height: 2.75rem;
                margin: 0.5rem 0;
            }
        }
        
        /* Small screens */
        @media (max-width: 375px) {
            .container {
                padding: 0.5rem;
            }
            
            .header-title {
                font-size: 1.5rem;
            }
            
            .download-btn, .share-btn, .new-assessment-btn {
                font-size: 0.8rem;
                padding: 0.625rem 0.875rem;
                min-height: 2.5rem;
            }
        }
        
        /* PDF Export Styles */
        @media print {
            body {
                background: white !important;
                color: black !important;
            }
            
            .container {
                max-width: none !important;
                margin: 0 !important;
                padding: 20px !important;
            }
            
            .header-card, .summary-card, .urgent-section, .category-card {
                background: white !important;
                border: 1px solid #ddd !important;
                box-shadow: none !important;
                margin-bottom: 20px !important;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header Card -->
        <div class="header-card">
            <h1 class="header-title">Your Personalized Screening Plan</h1>
            <p class="header-subtitle">These are the tests that matter most for your prevention and longevity journey.</p>
        </div>
        
        <!-- Assessment Summary -->
        <div class="summary-card">
            <h2 class="summary-title">ASSESSMENT SUMMARY</h2>
            <p class="summary-text" id="assessmentSummary">
                Based on your age, family history of diabetes, and lifestyle factors, there are several areas of concern. Your frequent fatigue, skin changes, and borderline magnesium/zinc levels suggest potential nutritional deficiencies. Abnormal electrolyte and bio-aging results, along with an outdated microbiome assessment, indicate potential metabolic and gut health issues. Your plant-based diet and moderate alcohol consumption are generally positive, but specific tests are needed to ensure optimal health.
            </p>
        </div>
        
        <!-- Urgent Tests Section -->
        <div class="urgent-tests-section">
            <div class="urgent-tests-header">
                <div class="urgent-tests-icon">üö®</div>
                <div>
                    <h2 class="urgent-tests-title">Urgent Tests</h2>
                    <p class="urgent-tests-subtitle">Tests that should be completed within the next month</p>
                </div>
            </div>
            <div class="urgent-tests-grid" id="urgentTests">
                <!-- Urgent tests will be populated here -->
            </div>
        </div>
        
        <!-- Categories Grid - Hidden for clean layout -->
        <div class="categories-grid" id="categoriesGrid" style="display: none;">
            <!-- Categories will be populated here -->
        </div>
        
        <!-- Next Steps - Hidden for clean layout -->
        <div class="next-steps" style="display: none;">
            <h2 class="next-steps-title">NEXT STEPS</h2>
            <div id="nextSteps">
                <!-- Next steps will be populated here -->
            </div>
        </div>
        
        <!-- Download Button -->
        <div class="download-section">
            <button class="download-btn" onclick="downloadPlan()">DOWNLOAD YOUR SCREENING PLAN</button>
            <button class="share-btn" onclick="shareResults()">SHARE YOUR RESULTS</button>
            <button class="new-assessment-btn" onclick="startNewAssessment()">START NEW ASSESSMENT</button>
        </div>
        
        <!-- Motivational Quote -->
        <div class="quote-section">
            <p class="quote-text">
                "By completing these screenings, you're building the foundation for a longer, healthier life. Each test brings you closer to understanding your body's unique needs and optimizing your healthspan."
            </p>
        </div>
    </div>

    <!-- Provider Selection Modal -->
    <div id="providerModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalTitle">Available Tests</h2>
                <span class="close" onclick="closeProviderModal()">&times;</span>
            </div>
            <div class="modal-body">
                <div id="modalLoading" class="loading-state">
                    <div class="spinner"></div>
                    <p>Loading available tests...</p>
                </div>
                <div id="modalContent" class="provider-list" style="display: none;">
                    <!-- Provider options will be loaded here -->
                </div>
            </div>
        </div>
    </div>

    <script>
        // Force dark background
        document.documentElement.style.backgroundColor = '#0a0a0a';
        document.body.style.backgroundColor = '#0a0a0a';
        
        // Check if we have cached results from loading page
        const cachedResults = localStorage.getItem('healthAssessmentResults');
        const questionnaireData = localStorage.getItem('questionnaireData');
        console.log('üìã Checking for cached results:', cachedResults);
        console.log('üìã Checking for questionnaire data:', questionnaireData);
        
        // Debug: Show what's actually in localStorage
        console.log('üîç All localStorage keys:', Object.keys(localStorage));
        console.log('üîç healthAssessmentResults length:', cachedResults ? cachedResults.length : 'null');
        console.log('üîç questionnaireData length:', questionnaireData ? questionnaireData.length : 'null');
        
        // Debug: Show all localStorage values
        for (let i = 0; i < localStorage.length; i++) {
            const key = localStorage.key(i);
            const value = localStorage.getItem(key);
            console.log('üîç localStorage[' + key + ']:', value ? value.substring(0, 100) + '...' : 'null');
        }
        
        if (cachedResults) {
            console.log('‚úÖ Using cached results from loading page');
            const data = JSON.parse(cachedResults);
            console.log('üîç Parsed data:', data);
            console.log('üîç Data type:', typeof data);
            console.log('üîç Data keys:', Object.keys(data));
            displayResults(data);
            
            // Track test completion
            if (window.onTestComplete) {
                window.onTestComplete('health_screening_results');
            }
            
        } else if (questionnaireData) {
            console.log('‚ùå No cached results, but have questionnaire data - redirecting to loading page');
            window.location.href = '/loading.html';
        } else {
            console.log('‚ùå No data found, redirecting to start new assessment');
            window.location.href = '/';
        }
        

        // Email sending is handled by email-collection page, no need for duplicate function here
        
        // Email generation functions removed - handled by email-collection page
        
        // Function to break description into horizontal sections
        function breakDescriptionIntoSections(description) {
            console.log('üîç Breaking description into sections:', description);
            
            if (!description || description === 'No description available') {
                return `<div class="explanation-section">
                    <h4>Description</h4>
                    <p>No description available</p>
                </div>`;
            }
            
            // Split the description into sentences
            const sentences = description.split(/[.!?]+/).filter(s => s.trim().length > 0);
            
            // Group sentences into logical sections
            const sections = [];
            let currentSection = [];
            
            for (let i = 0; i < sentences.length; i++) {
                const sentence = sentences[i].trim();
                if (sentence.length === 0) continue;
                
                currentSection.push(sentence);
                
                // Create a new section every 2-3 sentences or when we hit certain keywords
                if (currentSection.length >= 2 || 
                    sentence.toLowerCase().includes('this test') ||
                    sentence.toLowerCase().includes('given your') ||
                    sentence.toLowerCase().includes('the results') ||
                    sentence.toLowerCase().includes('early detection') ||
                    sentence.toLowerCase().includes('adequate') ||
                    i === sentences.length - 1) {
                    
                    if (currentSection.length > 0) {
                        sections.push(currentSection.join('. ') + '.');
                        currentSection = [];
                    }
                }
            }
            
            // If we have remaining sentences, add them as a final section
            if (currentSection.length > 0) {
                sections.push(currentSection.join('. ') + '.');
            }
            
            // Generate section titles based on content
            const sectionTitles = [
                'Why This Test Matters',
                'What It Measures',
                'Health Benefits',
                'Personalized Results'
            ];
            
            // Create HTML for each section
            const result = sections.map((section, index) => {
                const title = sectionTitles[index] || `Key Point ${index + 1}`;
                return `
                    <div class="explanation-section">
                        <h4>${title}</h4>
                        <p>${section}</p>
                    </div>
                `;
            }).join('');
            
            console.log('‚úÖ Generated sections HTML:', result);
            return result;
        }
        
        // Provider Modal Functions
        async function openProviderModal(testName) {
            console.log('Opening provider modal for:', testName);
            
            const modal = document.getElementById('providerModal');
            const modalTitle = document.getElementById('modalTitle');
            const modalLoading = document.getElementById('modalLoading');
            const modalContent = document.getElementById('modalContent');
            
            // Set modal title
            modalTitle.textContent = `Available ${testName} Tests`;
            
            // Show modal and loading state
            modal.style.display = 'block';
            modalLoading.style.display = 'block';
            modalContent.style.display = 'none';
            
            try {
                // Fetch available tests for this type
                const response = await fetch(`https://thearc-website-nzer-kwqu90dlv-annas-projects-3d23b0f3.vercel.app/api/tests-by-type?type=${encodeURIComponent(testName)}`);
                const data = await response.json();
                
                if (data.success && data.data.products.length > 0) {
                    displayProviderOptions(data.data.products, testName);
                } else {
                    displayNoResults(testName);
                }
            } catch (error) {
                console.error('Error fetching provider options:', error);
                displayError();
            }
        }
        
        function displayProviderOptions(products, testName) {
            const modalLoading = document.getElementById('modalLoading');
            const modalContent = document.getElementById('modalContent');
            
            modalLoading.style.display = 'none';
            modalContent.style.display = 'block';
            
            const providerList = products.map(product => `
                <div class="provider-card">
                    <div class="provider-header">
                        ${product.provider.logo ? 
                            `<img src="${product.provider.logo}" alt="${product.provider.name}" class="provider-logo">` :
                            `<div class="provider-logo" style="background: #8b5cf6; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold;">${product.provider.name.charAt(0)}</div>`
                        }
                        <div class="provider-info">
                            <h3>${product.provider.name}</h3>
                            <div class="provider-location">${product.provider.location}</div>
                                    </div>
                            </div>
                    <div class="provider-description">
                        ${product.description}
                                    </div>
                    <div class="provider-price">
                        ${product.price && product.price > 0 ? `${product.price} EUR` : 'Price Unknown'}
                            </div>
                    <div class="provider-actions">
                        <a href="/marketplace/product/${product.id}" target="_blank" class="btn-primary">
                            View Details
                        </a>
                        <a href="/marketplace/provider/${product.provider.id}" target="_blank" class="btn-secondary">
                            View Provider
                        </a>
                        </div>
                        </div>
            `).join('');
            
            modalContent.innerHTML = `
                <div class="provider-list">
                    ${providerList}
                    </div>
            `;
        }
        
        function displayNoResults(testName) {
            const modalLoading = document.getElementById('modalLoading');
            const modalContent = document.getElementById('modalContent');
            
            modalLoading.style.display = 'none';
            modalContent.style.display = 'block';
            
            modalContent.innerHTML = `
                <div style="text-align: center; padding: 2rem;">
                    <div style="font-size: 3rem; margin-bottom: 1rem;">üîç</div>
                    <h3 style="color: white; margin-bottom: 1rem;">No specific ${testName} tests found</h3>
                    <p style="color: #cbd5e1; margin-bottom: 2rem;">
                        We couldn't find exact matches for "${testName}" in our catalog, but you can explore related tests in our marketplace.
                    </p>
                    <a href="/marketplace" target="_blank" class="btn-primary">
                        Browse All Tests
                    </a>
                </div>
            `;
        }
        
        function displayError() {
            const modalLoading = document.getElementById('modalLoading');
            const modalContent = document.getElementById('modalContent');
            
            modalLoading.style.display = 'none';
            modalContent.style.display = 'block';
            
            modalContent.innerHTML = `
                <div style="text-align: center; padding: 2rem;">
                    <div style="font-size: 3rem; margin-bottom: 1rem;">‚ö†Ô∏è</div>
                    <h3 style="color: white; margin-bottom: 1rem;">Unable to load tests</h3>
                    <p style="color: #cbd5e1; margin-bottom: 2rem;">
                        There was an error loading the available tests. Please try again or browse our marketplace directly.
                    </p>
                    <a href="/marketplace" target="_blank" class="btn-primary">
                        Browse Marketplace
                    </a>
                </div>
            `;
        }
        
        function closeProviderModal() {
            const modal = document.getElementById('providerModal');
            modal.style.display = 'none';
        }
        
        // Close modal when clicking outside of it
        window.onclick = function(event) {
            const modal = document.getElementById('providerModal');
            if (event.target === modal) {
                closeProviderModal();
            }
        }
        
        // Function to display results from API response
        async function displayResults(data) {
            console.log('üéØ Displaying results:', data);
            console.log('üéØ Data keys:', Object.keys(data));
            
            // Handle API response structure - data might be wrapped in 'data' field
            let actualData = data;
            if (data.data) {
                actualData = data.data;
                console.log('üéØ Using wrapped data:', actualData);
            } else if (data.fallbackData) {
                actualData = data.fallbackData;
                console.log('üéØ Using fallback data:', actualData);
            }
            
            // Email already sent from email-collection page, no need to send again
            console.log('üìß Email already sent from email-collection page, skipping duplicate send');
            
            console.log('üéØ Urgent tests:', actualData.urgentTests || actualData.urgent_tests);
            console.log('üéØ Categories:', actualData.categories);
            console.log('üéØ Next steps:', actualData.nextSteps || actualData.next_steps);
            
            // Update assessment summary
            if (actualData.assessmentSummary || actualData.assessment_summary) {
                document.getElementById('assessmentSummary').innerHTML = actualData.assessmentSummary || actualData.assessment_summary;
                console.log('‚úÖ Assessment summary updated');
            } else {
                console.error('‚ùå No assessment summary found');
            }
            
            // Map recommendations to catalog products
            const allRecommendations = [];
            const urgentTests = actualData.urgentTests || actualData.urgent_tests;
            if (urgentTests && Array.isArray(urgentTests)) {
                allRecommendations.push(...urgentTests);
            }
            
            if (actualData.categories && Array.isArray(actualData.categories)) {
                actualData.categories.forEach(category => {
                    if (category.tests && Array.isArray(category.tests)) {
                        allRecommendations.push(...category.tests);
                    }
                });
            }
            
            // Map recommendations to catalog products
            let mappedRecommendations = [];
            if (allRecommendations.length > 0) {
                try {
                    console.log('üîó Mapping recommendations to catalog products...');
                    const response = await fetch('https://thearc-website-nzer-kwqu90dlv-annas-projects-3d23b0f3.vercel.app/api/map-screening-results', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({ recommendations: allRecommendations })
                    });
                    
                    if (response.ok) {
                        const mappingData = await response.json();
                        mappedRecommendations = mappingData.data.mappedRecommendations;
                        console.log('‚úÖ Mapped recommendations:', mappedRecommendations);
                    } else {
                        console.warn('‚ö†Ô∏è Failed to map recommendations, using original data');
                    }
                } catch (error) {
                    console.warn('‚ö†Ô∏è Error mapping recommendations:', error);
                }
            }
            
            // Update urgent tests with catalog links
            if (urgentTests && Array.isArray(urgentTests)) {
                console.log('üéØ Calling displayUrgentTests with:', urgentTests);
                displayUrgentTestsWithLinks(urgentTests, mappedRecommendations);
            } else {
                console.error('‚ùå No urgent tests data found or not an array:', urgentTests);
            }
            
            // Update categories with catalog links
            if (actualData.categories && Array.isArray(actualData.categories)) {
                console.log('üéØ Calling displayCategoriesFromAPI with:', actualData.categories);
                console.log('üéØ Number of categories:', actualData.categories.length);
                console.log('üéØ Category names:', actualData.categories.map(c => c.category_name));
                displayCategoriesFromAPIWithLinks(actualData.categories, mappedRecommendations);
            } else {
                console.error('‚ùå No categories data found or not an array:', actualData.categories);
            }
            
            // Update next steps
            const nextSteps = actualData.nextSteps || actualData.next_steps;
            if (nextSteps && Array.isArray(nextSteps)) {
                console.log('üéØ Calling displayNextSteps with:', nextSteps);
                displayNextSteps(nextSteps);
            } else {
                console.error('‚ùå No next steps data found or not an array:', nextSteps);
            }
        }
        
        // Function to get hardcoded data as fallback
        function getHardcodedData() {
            return {
                assessmentSummary: "Based on your age, family history of diabetes, and lifestyle factors, there are several areas of concern. Your frequent fatigue, skin changes, and borderline magnesium/zinc levels suggest potential nutritional deficiencies. Abnormal electrolyte and bio-aging results, along with an outdated microbiome assessment, indicate potential metabolic and gut health issues. Your plant-based diet and moderate alcohol consumption are generally positive, but specific tests are needed to ensure optimal health.",
                urgentTests: [
                    {
                        name: "HbA1c (3-month average blood sugar)",
                        explanation: "Given your family history of diabetes, it's critical to assess your current blood sugar control.",
                        timeframe: "Schedule within 1-2 weeks",
                        status: "RECOMMENDED"
                    },
                    {
                        name: "Omega-3 Index",
                        explanation: "You've never had this test, and it's important to ensure adequate omega-3 intake on a plant-based diet.",
                        timeframe: "Schedule within 1-2 weeks",
                        status: "NEVER DONE"
                    }
                ],
                categories: [
                    {
                        category_name: "Cardiovascular Health",
                        category_description: "Heart disease is the leading cause of death worldwide, and early detection of risk factors is key.",
                        tests: [
                            { 
                                name: "Lipid Panel", 
                                description: "This test measures cholesterol levels, which can indicate cardiovascular risk. It's especially important due to your family history of diabetes.", 
                                status: "DUE SOON" 
                            }
                        ]
                    },
                    {
                        category_name: "Metabolic Health",
                        category_description: "Metabolic health is crucial for energy, weight management, and preventing chronic diseases.",
                        tests: [
                            { 
                                name: "Comprehensive Metabolic Panel", 
                                description: "Your previous abnormal electrolyte results and frequent fatigue warrant a comprehensive metabolic assessment.", 
                                status: "DUE SOON" 
                            }
                        ]
                    },
                    {
                        category_name: "Hormonal Health",
                        category_description: "Hormones regulate many body functions, and imbalances can cause various symptoms.",
                        tests: [
                            { 
                                name: "Thyroid Function Tests", 
                                description: "Your fatigue and skin changes could be symptoms of thyroid dysfunction.", 
                                status: "RECOMMENDED" 
                            }
                        ]
                    },
                    {
                        category_name: "Nutritional Status",
                        category_description: "Nutrient deficiencies can cause a range of health problems and are often overlooked.",
                        tests: [
                            { 
                                name: "Magnesium and Zinc Levels", 
                                description: "Your borderline results and plant-based diet make it important to monitor these essential minerals.", 
                                status: "DUE SOON" 
                            }
                        ]
                    },
                    {
                        category_name: "Longevity Biomarkers",
                        category_description: "These tests can provide insights into your biological age and potential longevity.",
                        tests: [
                            { 
                                name: "Advanced Bio-aging Panel", 
                                description: "Your previous abnormal bio-aging results need follow-up to assess your biological age.", 
                                status: "RECOMMENDED" 
                            }
                        ]
                    },
                    {
                        category_name: "Gut Health",
                        category_description: "Gut health affects overall wellness, immunity, and even mental health.",
                        tests: [
                            { 
                                name: "Comprehensive Microbiome Analysis", 
                                description: "Your outdated microbiome assessment needs updating to understand your current gut health status.", 
                                status: "DUE SOON" 
                            }
                        ]
                    }
                ],
                nextSteps: [
                    { action: "Schedule your HbA1c test within the next 1-2 weeks" },
                    { action: "Book your Omega-3 Index test to assess your fatty acid status" },
                    { action: "Consider a comprehensive metabolic panel to address your fatigue concerns" },
                    { action: "Update your microbiome assessment to get current gut health insights" }
                ]
            };
        }
        
        // Function to display categories from API response
        function displayCategoriesFromAPI(categories) {
            const categoriesContainer = document.getElementById('categoriesGrid');
            categoriesContainer.innerHTML = '';
            
            const iconMap = {
                'Cardiovascular Health': { icon: '‚ù§Ô∏è', class: 'icon-cardiovascular' },
                'Metabolic Health': { icon: '‚ö°', class: 'icon-metabolic' },
                'Hormonal Health': { icon: '‚öñÔ∏è', class: 'icon-hormonal' },
                'Nutritional Status': { icon: 'üåø', class: 'icon-nutritional' },
                'Longevity Biomarkers': { icon: 'üß¨', class: 'icon-longevity' },
                'Gut Health': { icon: 'üéØ', class: 'icon-gut' }
            };
            
            categories.forEach(category => {
                const categoryElement = document.createElement('div');
                categoryElement.className = 'category-card';
                
                const iconInfo = iconMap[category.category_name] || { icon: 'üìä', class: 'icon-metabolic' };
                
                let testsHtml = '';
                if (category.tests && category.tests.length > 0) {
                    testsHtml = category.tests.map(test => {
                        const statusClass = test.status === 'RECOMMENDED' ? 'status-recommended' : 'status-due-soon';
                        return `
                            <div class="category-test">
                                <div class="test-header">
                                    <div class="test-title">${test.test || test.name || 'Test'}</div>
                                    <div class="test-status ${statusClass}">${test.status}</div>
                                </div>
                                <div class="test-explanation">${test.reason || test.description || 'No description available'}</div>
                            </div>
                        `;
                    }).join('');
                }
                
                categoryElement.innerHTML = `
                    <div class="category-header">
                        <div class="category-icon ${iconInfo.class}">${iconInfo.icon}</div>
                        <div class="category-info">
                            <h3 class="category-title">${category.category_name}</h3>
                            <p class="category-description">${category.category_description}</p>
                        </div>
                    </div>
                    <div class="category-tests">
                        ${testsHtml}
                    </div>
                `;
                
                categoriesContainer.appendChild(categoryElement);
            });
        }
        
        // Function to display next steps from API response
        function displayNextSteps(nextSteps) {
            const nextStepsContainer = document.getElementById('nextSteps');
            nextStepsContainer.innerHTML = '';
            
            nextSteps.forEach(step => {
                const stepElement = document.createElement('div');
                stepElement.className = 'next-step';
                stepElement.innerHTML = `
                    <div class="step-icon">‚úì</div>
                    <div class="step-text">${step.action}</div>
                `;
                nextStepsContainer.appendChild(stepElement);
            });
        }
        
        // New function to display urgent tests with catalog links
        function displayUrgentTestsWithLinks(urgentTests, mappedRecommendations) {
            console.log('üö® displayUrgentTestsWithLinks called with:', urgentTests);
            const urgentContainer = document.getElementById('urgentTests');
            console.log('üö® Urgent container element:', urgentContainer);
            urgentContainer.innerHTML = '';
            
            if (!urgentTests || !Array.isArray(urgentTests)) {
                console.error('‚ùå No urgent tests data provided or not an array:', urgentTests);
                return;
            }
            
            console.log('‚úÖ Processing urgent tests with catalog links:', urgentTests.length, 'items');
            
            urgentTests.forEach(test => {
                const testElement = document.createElement('div');
                testElement.className = 'urgent-test-card';
                
                // Find matching catalog product
                const mappedTest = mappedRecommendations.find(mapped => 
                    mapped.name === test.name || mapped.test === test.name
                );
                
                let catalogLink = '';
                if (mappedTest && mappedTest.catalogProduct) {
                    catalogLink = `
                        <button class="urgent-catalog-btn" onclick="openProviderModal('${test.test || test.name}')">
                            View in Catalog ‚Üí
                        </button>
                        <p class="urgent-match-info">${mappedTest.matchReason}</p>
                    `;
                } else {
                    catalogLink = `
                        <button class="urgent-catalog-btn" onclick="openProviderModal('${test.test || test.name}')">
                            View in Catalog ‚Üí
                        </button>
                        <p class="urgent-match-info">Searching available options</p>
                    `;
                }
                
                testElement.innerHTML = `
                    <div class="urgent-test-header">
                        <div class="urgent-test-title">${test.test || test.name || 'Test'}</div>
                        <div class="urgent-test-status">URGENT</div>
                    </div>
                    <div class="urgent-test-content">
                        <div class="urgent-test-explanation">
                            <h4>WHY THIS TEST MATTERS</h4>
                            <p>${test.reason || test.explanation || 'This test is important for your health and should be completed as soon as possible.'}</p>
                        </div>
                        <div class="urgent-test-actions">
                            ${catalogLink}
                        </div>
                    </div>
                `;
                
                urgentContainer.appendChild(testElement);
            });
        }
        
        // New function to display categories with catalog links
        function displayCategoriesFromAPIWithLinks(categories, mappedRecommendations) {
            const categoriesContainer = document.getElementById('categoriesGrid');
            categoriesContainer.innerHTML = '';
            
            const iconMap = {
                'Cardiovascular Health': { icon: '‚ù§Ô∏è', class: 'icon-cardiovascular' },
                'Metabolic Health': { icon: '‚ö°', class: 'icon-metabolic' },
                'Hormonal Health': { icon: '‚öñÔ∏è', class: 'icon-hormonal' },
                'Nutritional Status': { icon: 'üåø', class: 'icon-nutritional' },
                'Longevity Biomarkers': { icon: 'üß¨', class: 'icon-longevity' },
                'Gut Health': { icon: 'üéØ', class: 'icon-gut' }
            };
            
            categories.forEach(category => {
                const categoryElement = document.createElement('div');
                categoryElement.className = 'category-card';
                
                const iconInfo = iconMap[category.category_name] || { icon: 'üìä', class: 'icon-metabolic' };
                
                let testsHtml = '';
                if (category.tests && category.tests.length > 0) {
                    testsHtml = category.tests.map(test => {
                        const statusClass = test.status === 'RECOMMENDED' ? 'status-recommended' : 'status-due-soon';
                        
                        // Find matching catalog product
                        const mappedTest = mappedRecommendations.find(mapped => 
                            mapped.name === test.name || mapped.test === test.name
                        );
                        
                        let catalogLink = '';
                        if (mappedTest && mappedTest.catalogProduct) {
                            catalogLink = `
                                <div class="catalog-link">
                                    <button onclick="openProviderModal('${test.test || test.name}')" class="catalog-btn">
                                        View in Catalog ‚Üí
                                    </button>
                                    <span class="match-info">${mappedTest.matchReason}</span>
                                </div>
                            `;
                        } else {
                            // Show modal even if no exact match found
                            catalogLink = `
                                <div class="catalog-link">
                                    <button onclick="openProviderModal('${test.test || test.name}')" class="catalog-btn">
                                        View in Catalog ‚Üí
                                    </button>
                                    <span class="match-info">Searching available options</span>
                                </div>
                            `;
                        }
                        
                        // Break description into horizontal sections
                        const description = test.reason || test.description || 'No description available';
                        const explanationSections = breakDescriptionIntoSections(description);
                        
                        return `
                            <div class="category-test">
                                <div class="test-header">
                                    <div class="test-title">${test.test || test.name || 'Test'}</div>
                                    <div class="test-status ${statusClass}">${test.status}</div>
                                </div>
                                <div class="test-content">
                                    <div class="test-explanation">
                                        ${explanationSections}
                                    </div>
                                    <div class="test-actions">
                                        ${catalogLink}
                                    </div>
                                </div>
                            </div>
                        `;
                    }).join('');
                }
                
                categoryElement.innerHTML = `
                    <div class="category-header">
                        <div class="category-icon ${iconInfo.class}">${iconInfo.icon}</div>
                        <div class="category-info">
                            <h3 class="category-title">${category.category_name}</h3>
                            <p class="category-description">${category.category_description}</p>
                        </div>
                    </div>
                    <div class="category-tests">
                        ${testsHtml}
                    </div>
                `;
                
                categoriesContainer.appendChild(categoryElement);
            });
        }
        
        function displayUrgentTests(urgentTests) {
            console.log('üö® displayUrgentTests called with:', urgentTests);
            const urgentContainer = document.getElementById('urgentTests');
            console.log('üö® Urgent container element:', urgentContainer);
            urgentContainer.innerHTML = '';
            
            if (!urgentTests || !Array.isArray(urgentTests)) {
                console.error('‚ùå No urgent tests data provided or not an array:', urgentTests);
                return;
            }
            
            console.log('‚úÖ Processing urgent tests:', urgentTests.length, 'items');
            
            urgentTests.forEach(test => {
                const testElement = document.createElement('div');
                testElement.className = 'urgent-test';
                
                const statusClass = test.status === 'RECOMMENDED' ? 'status-recommended' : 'status-never-done';
                
                testElement.innerHTML = `
                    <div class="test-info">
                        <div class="test-name">${test.test || test.name || 'Test'}</div>
                        <div class="test-description">${test.reason || test.explanation || 'No description available'}</div>
                        <div class="test-timeframe">Timeframe: ${test.timeframe}</div>
                    </div>
                    <div class="test-status ${statusClass}">${test.status}</div>
                `;
                
                urgentContainer.appendChild(testElement);
            });
        }
        
        function displayNextSteps(nextSteps) {
            console.log('üö® displayNextSteps called with:', nextSteps);
            const nextStepsContainer = document.getElementById('nextSteps');
            console.log('üö® Next steps container element:', nextStepsContainer);
            nextStepsContainer.innerHTML = '';
            
            if (!nextSteps || !Array.isArray(nextSteps)) {
                console.error('‚ùå No next steps data provided or not an array:', nextSteps);
                return;
            }
            
            console.log('‚úÖ Processing next steps:', nextSteps.length, 'items');
            
            nextSteps.forEach(step => {
                const stepElement = document.createElement('div');
                stepElement.className = 'timeframe-section';
                
                const isUrgent = step.timeframe.toLowerCase().includes('urgent');
                const lineClass = isUrgent ? 'line-urgent' : 'line-medium';
                
                const actionsHtml = step.actions.map(action => 
                    `<div class="action-item">${action}</div>`
                ).join('');
                
                stepElement.innerHTML = `
                    <div class="timeframe-header">
                        <div class="timeframe-line ${lineClass}"></div>
                        <div class="timeframe-label">${step.timeframe}</div>
                    </div>
                    <div class="timeframe-actions">
                        ${actionsHtml}
                    </div>
                `;
                
                nextStepsContainer.appendChild(stepElement);
            });
        }
        
        function startNewAssessment() {
            console.log('üîÑ Starting new assessment...');
            
            // Clear all localStorage data
            localStorage.removeItem('questionnaireData');
            localStorage.removeItem('healthAssessmentResults');
            localStorage.removeItem('cachedResults');
            
            console.log('‚úÖ All data cleared - redirecting to questionnaire');
            
            // Redirect to questionnaire
            window.location.href = '/questionnaire.html';
        }
        
    function shareResults() {
        // Track share reveal event
        if (window.trackShareReveal) {
            window.trackShareReveal();
        }
            
            // Get the results data
            const results = JSON.parse(localStorage.getItem('healthAssessmentResults') || '{}');
            
            if (navigator.share) {
                // Use native sharing if available
                navigator.share({
                    title: 'My Health Screening Results - TheArc',
                    text: 'I just completed my personalized health screening with TheArc. Check out my results!',
                    url: window.location.href
                }).then(() => {
                    console.log('Results shared successfully');
                }).catch((error) => {
                    console.error('Error sharing:', error);
                    fallbackShare();
                });
            } else {
                // Fallback to copy to clipboard
                fallbackShare();
            }
        }
        
        function fallbackShare() {
            const shareText = 'I just completed my personalized health screening with TheArc. Check out my results!';
            const shareUrl = window.location.href;
            
            if (navigator.clipboard) {
                navigator.clipboard.writeText(`${shareText} ${shareUrl}`).then(() => {
                    alert('Results link copied to clipboard!');
                }).catch(() => {
                    // Final fallback - show the URL
                    prompt('Copy this link to share your results:', shareUrl);
                });
            } else {
                // Final fallback - show the URL
                prompt('Copy this link to share your results:', shareUrl);
            }
        }
        
        
        function downloadPlan() {
            console.log('üîÑ Starting PDF generation...');
            
            // Show loading state
            const downloadBtn = document.querySelector('.download-btn');
            const originalText = downloadBtn.textContent;
            downloadBtn.textContent = 'GENERATING PDF...';
            downloadBtn.disabled = true;
            
            try {
                // Use the simple PDF generation method
                generateSimplePDF();
                
                // Reset button state after a short delay
                setTimeout(() => {
                    downloadBtn.textContent = originalText;
                    downloadBtn.disabled = false;
                }, 1000);
                
            } catch (error) {
                console.error('‚ùå Error generating PDF:', error);
                alert('PDF generation failed. Please try again.');
                
                // Reset button state
                downloadBtn.textContent = originalText;
                downloadBtn.disabled = false;
            }
        }
        
        
        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', function() {
            console.log('‚úÖ PDF generation ready (using browser print functionality)');
        });
    </script>
    
    <!-- Real backend API integration -->
</body>
</html>
